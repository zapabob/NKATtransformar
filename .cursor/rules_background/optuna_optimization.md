# Optuna最適化専用ルール背景説明

このドキュメントは[.cursor/rules/optuna_optimization.mdc](.cursor/rules/optuna_optimization.mdc)のルールの策定背景を説明します。

## 1. [早期枝刈り実装要件](1-早期枝刈り実装要件)

**背景**: 低性能パラメータでの無駄な計算時間を削減
**実例**: `if accuracy < threshold: raise optuna.TrialPruned()`
**理由**: RTX3080のGPU時間効率化とリソース最適化

## 2. [データセット特化パラメータ空間](2-データセット特化パラメータ空間)

**背景**: CIFAR-10の32x32画像特性に最適化された探索が必要
**実例**: `patch_size=[2,4]`, `embed_dim=[384,512]`の制限
**理由**: 汎用的過ぎる探索での効率低下防止

## 3. [詳細ログ出力による追跡性](3-詳細ログ出力による追跡性)

**背景**: 後の分析と改善のためのトレーサビリティ確保
**実例**: trial番号、パラメータ、結果、実行時間の記録
**理由**: 最適化プロセスの可視化と問題特定

## 4. [メモリリーク防止対策](4-メモリリーク防止対策)

**背景**: 連続trial実行でのGPUメモリ蓄積問題
**実例**: `del model, trainer; torch.cuda.empty_cache()`
**理由**: 長時間最適化でのOOM回避

## 5. [適切なPruner設定](5-適切なpruner設定)

**背景**: 効率的な枝刈りによる最適化加速
**実例**: `MedianPruner(n_startup_trials=2)`
**理由**: 無駄なtrialの早期終了

## 6. [結果の永続化と再利用](6-結果の永続化と再利用)

**背景**: 最適化結果の蓄積とセッション間での共有
**実例**: `best_config.json`自動保存、設定読み込み
**理由**: 最適化の継続性と知見の蓄積

## 7. [TPE最大化の組み込み](7-tpe最大化の組み込み)

**背景**: NKAT-Transformer独自の評価指標統合
**実例**: `objective = accuracy + tpe_score * weight`
**理由**: 精度だけでなく理論的効率性も考慮 